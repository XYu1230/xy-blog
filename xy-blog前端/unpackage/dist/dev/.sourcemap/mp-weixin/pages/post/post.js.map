{"version":3,"file":"post.js","sources":["pages/post/post.vue","../../tools/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcG9zdC9wb3N0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view class=\"post-form card\">\r\n      <view class=\"form-item\">\r\n        <input\r\n          type=\"text\"\r\n          class=\"input-box\"\r\n          v-model=\"blogData.title\"\r\n          placeholder=\"请输入博客标题\"\r\n          maxlength=\"50\"\r\n        />\r\n        <text class=\"input-count\">{{ blogData.title.length }}/50</text>\r\n      </view>\r\n\r\n      <view class=\"form-item\">\r\n        <textarea\r\n          class=\"textarea-box\"\r\n          v-model=\"blogData.content\"\r\n          placeholder=\"请输入博客内容...\"\r\n          maxlength=\"5000\"\r\n        ></textarea>\r\n        <text class=\"input-count\">{{ blogData.content.length }}/5000</text>\r\n      </view>\r\n\r\n      <view class=\"form-item\">\r\n        <view class=\"tags-wrapper\">\r\n          <view class=\"tags-title\">文章标签（最多3个）</view>\r\n          <view class=\"tags-box\">\r\n            <view\r\n              class=\"tag-item\"\r\n              :class=\"{ active: blogData.tags.includes(tag) }\"\r\n              v-for=\"(tag, index) in availableTags\"\r\n              :key=\"index\"\r\n              @click=\"toggleTag(tag)\"\r\n            >\r\n              {{ tag }}\r\n            </view>\r\n          </view>\r\n          <view class=\"add-tag-box\">\r\n            <input\r\n              type=\"text\"\r\n              class=\"tag-input\"\r\n              v-model=\"customTag\"\r\n              placeholder=\"添加自定义标签\"\r\n              maxlength=\"10\"\r\n            />\r\n            <button class=\"add-tag-btn\" @click=\"addCustomTag\">添加</button>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <view class=\"form-item\">\r\n        <view class=\"summary-title\">文章摘要</view>\r\n        <textarea\r\n          class=\"summary-box\"\r\n          v-model=\"blogData.summary\"\r\n          placeholder=\"请输入文章摘要，不填将自动提取正文前100字\"\r\n          maxlength=\"200\"\r\n        ></textarea>\r\n        <text class=\"input-count\">{{ blogData.summary.length }}/200</text>\r\n      </view>\r\n\r\n      <view class=\"form-actions\">\r\n        <button class=\"submit-btn btn-primary\" @click=\"submitBlog\">发布博客</button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { blogApi } from \"@/api/index.js\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      blogData: {\r\n        title: \"\",\r\n        content: \"\",\r\n        summary: \"\",\r\n        tags: [],\r\n      },\r\n      availableTags: [\"前端\", \"JavaScript\", \"Vue\", \"React\", \"Node.js\", \"后端\", \"数据库\", \"算法\", \"面试\", \"其他\"],\r\n      customTag: \"\",\r\n      isSubmitting: false,\r\n      titleLimit: 50,\r\n      contentLimit: 5000,\r\n      summaryLimit: 200,\r\n    };\r\n  },\r\n  onLoad() {\r\n    // 检查用户是否登录\r\n    const token = uni.getStorageSync(\"token\");\r\n    if (!token) {\r\n      uni.showToast({\r\n        title: \"请先登录\",\r\n        icon: \"none\",\r\n      });\r\n      \r\n      setTimeout(() => {\r\n        uni.redirectTo({\r\n          url: \"/pages/login/login\",\r\n        });\r\n      }, 1500);\r\n    }\r\n  },\r\n  methods: {\r\n    // 切换标签选择\r\n    toggleTag(tag) {\r\n      const index = this.blogData.tags.indexOf(tag);\r\n      if (index === -1) {\r\n        // 最多选择3个标签\r\n        if (this.blogData.tags.length >= 3) {\r\n          uni.showToast({\r\n            title: \"最多选择3个标签\",\r\n            icon: \"none\",\r\n          });\r\n          return;\r\n        }\r\n        this.blogData.tags.push(tag);\r\n      } else {\r\n        this.blogData.tags.splice(index, 1);\r\n      }\r\n    },\r\n    \r\n    // 添加自定义标签\r\n    addCustomTag() {\r\n      if (!this.customTag.trim()) {\r\n        uni.showToast({\r\n          title: \"标签不能为空\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n      \r\n      // 最多选择3个标签\r\n      if (this.blogData.tags.length >= 3) {\r\n        uni.showToast({\r\n          title: \"最多选择3个标签\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n      \r\n      // 标签长度限制\r\n      if (this.customTag.length > 10) {\r\n        uni.showToast({\r\n          title: \"标签最多10个字符\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n      \r\n      // 检查是否已存在\r\n      if (this.blogData.tags.includes(this.customTag)) {\r\n        uni.showToast({\r\n          title: \"标签已存在\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n      \r\n      this.blogData.tags.push(this.customTag);\r\n      this.customTag = \"\";\r\n    },\r\n    \r\n    // 提交博客\r\n    async submitBlog() {\r\n      // 表单验证\r\n      if (!this.blogData.title.trim()) {\r\n        uni.showToast({\r\n          title: \"请输入标题\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n      \r\n      if (!this.blogData.content.trim()) {\r\n        uni.showToast({\r\n          title: \"请输入内容\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n      \r\n      // 如果没有摘要，自动生成\r\n      if (!this.blogData.summary.trim()) {\r\n        // 从内容中提取前100个字符作为摘要\r\n        this.blogData.summary = this.blogData.content.replace(/<[^>]+>/g, \"\").substring(0, 100);\r\n      }\r\n      \r\n      this.isSubmitting = true;\r\n      \r\n      try {\r\n        const res = await blogApi.publishBlog(this.blogData);\r\n        \r\n        uni.showToast({\r\n          title: \"发布成功\",\r\n          icon: \"success\",\r\n        });\r\n        \r\n        // 发布成功后跳转到博客详情页\r\n        setTimeout(() => {\r\n          uni.redirectTo({\r\n            url: `/pages/detail/detail?id=${res.data.id}`,\r\n          });\r\n        }, 1500);\r\n      } catch (error) {\r\n        console.error(\"发布博客失败:\", error);\r\n      } finally {\r\n        this.isSubmitting = false;\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.container {\r\n  padding: 20rpx;\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n}\r\n\r\n.post-form {\r\n  padding: 30rpx;\r\n}\r\n\r\n.form-item {\r\n  margin-bottom: 30rpx;\r\n  position: relative;\r\n}\r\n\r\n.input-box {\r\n  width: 100%;\r\n  height: 90rpx;\r\n  font-size: 32rpx;\r\n  padding: 0 20rpx;\r\n  box-sizing: border-box;\r\n  border-bottom: 1px solid #eee;\r\n}\r\n\r\n.textarea-box {\r\n  width: 100%;\r\n  height: 500rpx;\r\n  font-size: 30rpx;\r\n  padding: 20rpx;\r\n  box-sizing: border-box;\r\n  border: 1px solid #eee;\r\n  border-radius: 10rpx;\r\n  background-color: #f9f9f9;\r\n}\r\n\r\n.input-count {\r\n  position: absolute;\r\n  right: 20rpx;\r\n  bottom: 10rpx;\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.tags-wrapper {\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.tags-title,\r\n.summary-title {\r\n  font-size: 30rpx;\r\n  font-weight: bold;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.tags-box {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.tag-item {\r\n  padding: 10rpx 30rpx;\r\n  background-color: #f0f8ff;\r\n  color: #333;\r\n  border-radius: 30rpx;\r\n  margin-right: 20rpx;\r\n  margin-bottom: 20rpx;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.tag-item.active {\r\n  background-color: #007aff;\r\n  color: #fff;\r\n}\r\n\r\n.add-tag-box {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.tag-input {\r\n  flex: 1;\r\n  height: 70rpx;\r\n  font-size: 28rpx;\r\n  padding: 0 20rpx;\r\n  border: 1px solid #eee;\r\n  border-radius: 10rpx;\r\n}\r\n\r\n.add-tag-btn {\r\n  width: 150rpx;\r\n  height: 70rpx;\r\n  line-height: 70rpx;\r\n  font-size: 28rpx;\r\n  background-color: #007aff;\r\n  color: #fff;\r\n  margin-left: 20rpx;\r\n}\r\n\r\n.summary-box {\r\n  width: 100%;\r\n  height: 200rpx;\r\n  font-size: 28rpx;\r\n  padding: 20rpx;\r\n  box-sizing: border-box;\r\n  border: 1px solid #eee;\r\n  border-radius: 10rpx;\r\n  background-color: #f9f9f9;\r\n}\r\n\r\n.form-actions {\r\n  margin-top: 50rpx;\r\n}\r\n\r\n.submit-btn {\r\n  width: 100%;\r\n  height: 90rpx;\r\n  line-height: 90rpx;\r\n  font-size: 32rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/Hbuilder项目/myblog/pages/post/post.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","blogApi"],"mappings":"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"}